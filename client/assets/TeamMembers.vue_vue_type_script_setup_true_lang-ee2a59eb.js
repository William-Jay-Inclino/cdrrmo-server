import{O as q,P as z,i as _,j as f,d as L,k as R,l as j,c as l,a as e,t as d,u as H,B as k,F as A,e as M,m as V,q as U,o as n,R as G,H as B,S as J,U as p,T as K,p as Q,n as W}from"./index-6bbaaed9.js";import{t as E}from"./team.store-9700f9bd.js";import{t as P}from"./training_skill.store-713a7512.js";import{a as I}from"./user.store-b2a1a52e.js";class X{getAllTeamMembers(b){console.log("getAllTeamMembers()");const u=I.getAllUsers();return q.teamMembers.filter(s=>s.team_id===b.teamId).map(s=>{const i=u.find(a=>a.user_id===s.member_id);if(i){s.member=i;const a=P.getPersonnelSkillsBy({personnel_id:s.member_id});a&&(s.skills=a)}return s})}}const N=new X,Ge=z("teamMember",()=>{const h=_([]),b=I.getAllUsers(),u=E.getAllTeams(),s=_();console.log("_users",b);const i=t=>{h.value=t},a=t=>{console.log("setTeamId()",t),s.value=t},g=f(()=>{console.log("_teamId",s),console.log("_teams",u);const t=u.find(c=>c.team_id===s.value);if(t)return t});return{teamMembers:f(()=>h.value.map(t=>{const c=b.find(T=>T.user_id===t.member_id);return c&&(t.member=c),t})),team:g,setTeamMembers:i,setTeamId:a,getTeamMembers:()=>N.getAllTeamMembers({teamId:s.value})}}),Y={class:"card shadow mb-4"},Z=e("div",{class:"card-header py-3 d-flex flex-row align-items-center justify-content-between text-bg-primary"},[e("h6",{class:"m-0 font-weight-bold"},"Team Info")],-1),ee={key:0,class:"card-body"},te={class:"table-responsive"},se={class:"table"},le=e("th",null,"Team Status",-1),ne=e("th",null,"Team Name",-1),ae=e("th",null,"Team Leader",-1),oe={key:0},re=["rowspan"],ue=e("button",{class:"btn btn-light btn-sm float-end"},[e("i",{class:"fas fa-fw fa-eye text-info"})],-1),ie=e("th",null,"Personnel Type",-1),ce=e("th",null,"Personnel Subtype",-1),de=e("th",null,"Personnel Sub-subtype",-1),Je=L({__name:"TeamInfo",props:{teamId:{}},setup(h){const b=h,u=_(),s=_(),i=_(),a=f(()=>b.teamId),g=f(()=>J[t.value.type]),x=f(()=>t.value?t.value.type===p.ACDV_BART||t.value.type===p.ACDV_CSO||t.value.type===p.ACDV_INDIVIDUAL||t.value.type===p.ACDV_PO?K[t.value.type]:t.value.sub_type_id?I.getSubType(t.value.type,t.value.sub_type_id)||"":void 0:void 0),C=f(()=>!t.value||!(t.value.type===p.ACDV_BART||t.value.type===p.ACDV_CSO||t.value.type===p.ACDV_INDIVIDUAL||t.value.type===p.ACDV_PO)||!t.value.sub_type_id?void 0:I.getSubType(t.value.type,t.value.sub_type_id)||""),t=f(()=>u.value?u.value.team_leader:null);R(a,async()=>c(a.value)),j(async()=>{c(a.value)});const c=async m=>{console.log("onUpdateTeamId()",m),u.value=await E.getTeamById(m),t.value&&(s.value=T(t.value.user_id)),i.value=N.getAllTeamMembers({teamId:m})},T=m=>{const y=P.getPersonnelSkillsBy({personnel_id:m});return y||[]};return(m,y)=>(n(),l("div",Y,[Z,u.value&&t.value?(n(),l("div",ee,[e("div",te,[e("table",se,[e("thead",null,[e("tr",null,[le,e("td",null,d(H(G)[u.value.status]),1)]),e("tr",null,[ne,e("td",null,d(u.value.team_name),1)]),e("tr",null,[ae,e("td",null,d(t.value.first_name+" "+t.value.last_name),1)]),s.value?(n(),l("tr",oe,[e("th",{rowspan:s.value.length+1,class:"align-middle"},"Skills",8,re)])):k("",!0),(n(!0),l(A,null,M(s.value,$=>{var w;return n(),l("tr",null,[e("td",null,[B(d((w=$.trainingSkill)==null?void 0:w.description)+" ",1),ue])])}),256)),e("tr",null,[ie,e("td",null,d(g.value),1)]),e("tr",null,[ce,e("td",null,d(x.value),1)]),V(e("tr",null,[de,e("td",null,d(C.value),1)],512),[[U,C.value]])])])])])):k("",!0)]))}}),me={class:"card shadow mb-4"},_e=e("div",{class:"card-header py-3 d-flex flex-row align-items-center justify-content-between text-bg-primary"},[e("h6",{class:"m-0 font-weight-bold"}," Manage Members ")],-1),be={class:"card-body"},ve={class:"table-responsive"},pe={class:"table"},fe=e("th",null," Name ",-1),he=e("th",{class:"pl-4"}," Skills ",-1),ge={key:0,class:"text-center"},ye=e("i",{class:"fas fa-fw fa-cogs"},null,-1),Se=[ye],Te={class:"align-middle"},ke={class:"list-group list-group-flush"},Ce={class:"list-group-item"},Ae=e("button",{class:"btn btn-light btn-sm float-end"},[e("i",{class:"fas fa-fw fa-eye text-info"})],-1),Me={key:0,class:"align-middle text-center"},Ie=["onClick"],xe=e("i",{class:"fas fa-fw fa-trash text-danger"},null,-1),we=[xe],De={class:"align-middle"},Ve=["value"],$e={class:"form-text text-danger"},Ue={class:"list-group list-group-flush"},Be={class:"list-group-item"},Pe=e("button",{class:"btn btn-light btn-sm float-end"},[e("i",{class:"fas fa-fw fa-eye text-info"})],-1),Ne={class:"text-center align-middle"},Oe=e("span",null,"Save",-1),Le=[Oe],Re={key:0,class:"text-center",colspan:"4"},je=e("i",{class:"fas fa-fw fa-plus"},null,-1),Ee=[je],Ke=L({__name:"TeamMembers",props:{teamId:{},canManage:{type:Boolean}},emits:["add-member","remove-member"],setup(h,{emit:b}){const u=h,s=b,i=_(),a=_(!1),g=f(()=>u.teamId),x=I.getAllUsers(),C=_([...x]),t=_(),c=_([]);R(g,async()=>T(g.value)),j(()=>{T(u.teamId)});const T=async o=>{i.value=N.getAllTeamMembers({teamId:o})},m=o=>{var r,v;if(console.log("onRemove()",o),!i.value)return;const S=(r=i.value)==null?void 0:r.findIndex(D=>D.member_id===o.member_id);if(S===-1){console.error("member not found");return}(v=i.value)==null||v.splice(S,1),s("remove-member")},y=()=>{a.value=!0},$=()=>{if(a.value=!1,!t.value||!i.value)return;const o={};o.member={...t.value},o.member_id=t.value.user_id,o.skills=[...c.value],o.team_id=g.value,o.team_member_id="",i.value.push(o),O(),s("add-member")},w=()=>{a.value=!1,O()},F=()=>{if(console.log("onChangeSelectedUser()"),!t.value)return;const o=P.getPersonnelSkillsBy({personnel_id:t.value.user_id});o&&(c.value=o)},O=()=>{t.value=void 0,c.value=[],a.value=!1};return(o,S)=>(n(),l("div",me,[_e,e("div",be,[e("div",ve,[e("table",pe,[e("thead",null,[e("tr",null,[fe,he,o.canManage?(n(),l("th",ge,Se)):k("",!0)])]),e("tbody",null,[(n(!0),l(A,null,M(i.value,r=>(n(),l("tr",null,[e("td",Te,d(r.member.first_name+" "+r.member.last_name),1),e("td",null,[e("ul",ke,[(n(!0),l(A,null,M(r.skills,v=>{var D;return n(),l("li",Ce,[B(d((D=v.trainingSkill)==null?void 0:D.description)+" ",1),Ae])}),256))])]),o.canManage?(n(),l("td",Me,[e("button",{onClick:v=>m(r),class:"btn btn-light"},we,8,Ie)])):k("",!0)]))),256)),V(e("tr",null,[e("td",De,[V(e("select",{onChange:S[0]||(S[0]=r=>F()),"onUpdate:modelValue":S[1]||(S[1]=r=>t.value=r),class:"form-control"},[(n(!0),l(A,null,M(C.value,r=>(n(),l("option",{value:r,key:r.user_id},d(r.first_name+" "+r.last_name),9,Ve))),128))],544),[[Q,t.value]]),V(e("small",$e,"Select Personnel",512),[[U,!t.value]])]),e("td",null,[e("ul",Ue,[(n(!0),l(A,null,M(c.value,r=>{var v;return n(),l("li",Be,[B(d((v=r.trainingSkill)==null?void 0:v.description)+" ",1),Pe])}),256))])]),e("td",Ne,[a.value?(n(),l("button",{key:0,onClick:$,class:W(["btn btn-success btn-sm",{disabled:!t.value}])},Le,2)):k("",!0)])],512),[[U,a.value]]),e("tr",null,[o.canManage?(n(),l("td",Re,[a.value?(n(),l("button",{key:1,onClick:w,class:"btn btn-outline-dark btn-sm btn-block"}," Cancel ")):(n(),l("button",{key:0,onClick:y,class:"btn btn-outline-primary btn-sm btn-block"},Ee))])):k("",!0)])])])])])]))}});export{Je as _,Ke as a,Ge as t};
