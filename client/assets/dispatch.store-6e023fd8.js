import{s as g,O as D,K as n,P as f,i as l,j as v,L as S}from"./index-6bbaaed9.js";import{e as T}from"./emergency.store-98a086ee.js";import{t as w}from"./team.store-9700f9bd.js";import{a as A}from"./user.store-b2a1a52e.js";class H{getAllDispatchTeams(){return console.log("getAllDispatchTeams()"),[]}async getDispatchById(s){return console.log("getDispatchById()",s),{}}async createDispatch(s){return console.log("createDispatch()",s),s.dispatch_id=g.string.uuid(),s.time_dispatch=new Date,s}async updateDispatch(s,i){return console.log("id",s),console.log("updateDispatch()",i),i.time_dispatch=new Date,i}async deleteDispatch(s){return console.log("deleteDispatch()",s),!0}async updateStatus(s,i){return console.log("dispatch_id",s),console.log("status",i),console.log("updateStatus"),{}}}const u=new H,I=D.getAuthUser(),r=T.getAllEmergencies(),o=w.getAllTeams(),h=A.getAllUsers(),m={dispatch_id:"",caller_name:"",dispatcher_id:I.user_id,caller_number:"",location:"",emergency_id:r[0].emergency_id,description:"",medical_description:"",num_people_involved:0,hazard:"",team_id:o[0].team_id,time_dispatch:new Date,remarks:"",time_proceeding:null,time_arrival:null,time_proceeding_hospital:null,time_arrival_hospital:null,status:n.Queue},B=f("dispatch",()=>{const c=l([]),s=l({...m}),i=v(()=>c.value.map(e=>(e.statusObj=S[e.status],e.emergency=r.find(t=>t.emergency_id===e.emergency_id),e.team=o.find(t=>t.team_id===e.team_id),e.teamLeader=h.find(t=>{var a;return t.user_id===((a=e.team)==null?void 0:a.team_leader_id)}),e.dispatcher=h.find(t=>t.user_id===e.dispatcher_id),e))),d=async e=>{if(console.log("saveDispatch()",e),e.dispatch_id.trim()!==""){console.log("update");const a=await u.updateDispatch(e.dispatch_id,e);return console.log("updatedDispatch ",a),a}const t=await u.createDispatch(e);return console.log("createdDispatch",t),c.value.unshift(t),p(),t},_=e=>{console.log("updateDispatchStatus()",e);const t=c.value.find(a=>a.dispatch_id===e.id);return t?(e.status===n.Dispatched?t.time_proceeding=new Date:e.status===n.Deck&&(t.time_arrival=new Date),t.status=e.status,t):(console.error("dispatchedTeam not found",t),null)},p=()=>{s.value={...m}};return{dispatchedTeams:i,formData:s,emergencies:r,teams:o,saveDispatch:d,resetFormData:p,updateDispatchStatus:_,onProceedingHospital:e=>{const t=c.value.find(a=>a.dispatch_id===e.dispatch_id);if(!t)return console.error("dispatchedTeam not found",t),null;t.time_proceeding_hospital=new Date},onArrivedHospital:e=>{const t=c.value.find(a=>a.dispatch_id===e.dispatch_id);if(!t)return console.error("dispatchedTeam not found",t),null;t.time_arrival_hospital=new Date}}});export{B as d};
